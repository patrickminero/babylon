<div class="container-fluid profile-page">
  <div class="row">
    <div class="col-12 col-md-10 col-lg-6 mx-auto mt-4">
      <div class="profile-container">
          <%= link_to edit_user_registration_path(@user), class: 'btn btn-outline-secondary edit-profile-btn' do %>
            <i class="far fa-edit"></i>
          <% end %>
          <% if !@user.photo.nil? %>
            <%= cl_image_tag @user.photo.key, height: 300, width: 400, crop: :fill, gravity: :face %>
          <% else %>
            <img src="https://res.cloudinary.com/dliczkabg/image/upload/v1610983854/profile-silhouette_oychwo.jpg" alt="">
          <% end %> 
        
        <div class="profile-info">
          <h1><%= @user.username.capitalize %></h1>
          <div>
            <h6><i class="far fa-envelope"></i> <%= @user.email %></h6>
          </div>
          <div>
            <h6><i class="fas fa-map-pin"></i> <%= @user.location %></h6>
          </div>
          <div>
            <h6><i class="fas fa-language"></i> <%= @user.preferred_language %></h6>
          </div>
          <div class="mt-3">
            <h5 class="mb-0">About me:</h5>
            <h6><%= @user.description %></h6>
          </div>
        </div>
      </div>
      <% if !@user.provider %>
        <div class="profile-action">
          <h3>Speak many languages?</h3>
          <%= link_to  "Become a provider", new_provider_path, class: "btn btn-secondary" %>
        </div>
      <% else %>
        <div class="profile-action">
          <%= link_to  "View my services", provider_path(Provider.find_by(user_id: @user.id)), class: "btn btn-secondary" %>
        </div>
      <% end %>
      <div class="profile-action">
        <nav>
          <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-link active w-50 text-secondary" id="nav-bookings-tab" data-bs-toggle="tab" href="#nav-bookings" role="tab" aria-controls="nav-bookings" aria-selected="true">Your bookings</a>
            <a class="nav-link w-50 text-secondary" id="nav-request-tab" data-bs-toggle="tab" href="#nav-request" role="tab" aria-controls="nav-request" aria-selected="false">Your requests</a>
          </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade show active" id="nav-bookings" role="tabpanel" aria-labelledby="nav-bookings-tab">
          <% if !@user.bookings.empty? %>
              <% @user.bookings.each do |booking| %>
                <div class="card mb-3 m-auto" style="max-width: 540px;">
                  <div class="row g-0">
                    <div class="col-md-4">
                      <%= cl_image_tag booking.provider.photos[0].key, crop: :fill, gravity: :face, class: 'bookings-provider-image' %>
                    </div>
                    <div class="col-md-8">
                      <div class="card-body">
                        <h5 class="card-title"><%= booking.provider.name %></h5>
                        <h6 class="card-text"><%= booking.provider.service_type %></h6>
                        <p class="card-text mb-0"><i class="fas fa-money-bill-wave"></i> €<%= booking.provider.rate %></p>
                        <p class="card-text mb-0"><i class="fas fa-map-pin"></i> <%= booking.provider.location %></p>
                        <p class="card-text mb-0"><i class="fas fa-clock"></i> <%= booking.date.strftime("%a %b %d, %Y") %> - <%= booking.time.strftime("%H:%M") %></p>
                        <p class="card-text mb-0"><i class="fas fa-language"></i>
                          <% booking.provider.languages_spoken.each do |lan| %>
                            <span><%= lan %></span>
                          <% end %>
                        </p>
                        <p class="card-text">Comments: <%= booking.comments %></p>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            <% else %>
              <h6 class="">You have not book services yet.</h6>
            <% end %>
          </div>
          <div class="tab-pane fade" id="nav-request" role="tabpanel" aria-labelledby="nav-request-tab">
            <% if !@requests.nil? %>
              <% @requests.each do |booking| %>
                <div class="card mb-3 m-auto" style="max-width: 540px;">
                  <div class="row g-0">
                    <div class="col-md-4">
                      <%= cl_image_tag booking.user.photo.key, crop: :fill, gravity: :face, class: 'bookings-provider-image' %>
                    </div>
                    <div class="col-md-8">
                      <div class="card-body">
                        <h5 class="card-title mb-0"><%= booking.user.username %></h5>
                        <p class="card-text mb-0"><i class="fas fa-money-bill-wave"></i> €<%= booking.provider.rate %></p>
                        <% if booking.pending %>
                          <div class="alert alert-warning mb-0" role="alert">
                            Pending for approval
                          </div>
                        <% else %>
                          <div class="alert alert-primary mb-0" role="alert">
                            Booking confirmed
                          </div>
                        <% end %>
                        <p class="card-text mb-0"><i class="fas fa-map-pin"></i> <%= booking.user.location %></p>
                        <p class="card-text mb-0"><i class="fas fa-clock"></i> <%= booking.date.strftime("%a %b %d, %Y") %> - <%= booking.time.strftime("%H:%M") %></p>
                        <p class="card-text mb-0">Comments: <%= booking.comments %></p>
                      </div>
                    </div>
                  </div>
                </div>
                <% end %>
            <% else %>
              <h6 class="">You don't have booking requests yet.</h6>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>